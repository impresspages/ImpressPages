$(document).ready(function(){"use strict";$('.ipsModuleInlineManagementLogo').ipModuleInlineManagementLogo();$('.ipsModuleInlineManagementText').ipModuleInlineManagementText();$('.ipsModuleInlineManagementImage').ipModuleInlineManagementImage();});(function($){"use strict";var hideTimer=0,controlsClass='ipsModuleInlineManagementControls',hiliteClass='_hilite',methods={init:function(options){return this.each(function(){var $this=$(this);if(!$('.'+controlsClass).length){$('body').append(ipModuleInlineManagementControls);}
var $controls=$('.'+controlsClass);$controls.off('mouseenter').on('mouseenter',function(event){clearTimeout(hideTimer);}).off('mouseleave').on('mouseleave',function(event){hideTimer=setTimeout(function(){$controls.hide();$('.'+hiliteClass).removeClass(hiliteClass);},30);});var data=$this.data('ipModuleInlineManagementControls');if(!data){$this.data('ipModuleInlineManagementControls',{initiated:1}).mouseenter(function(e){clearTimeout(hideTimer);$('.'+hiliteClass).removeClass(hiliteClass);$this.addClass(hiliteClass);var objOffset=$this.offset();$controls.css({left:objOffset.left,top:objOffset.top}).show();for(var key in options){$controls.find('.ipActionWidget'+key).show().off().on('click',function(event){event.preventDefault();if($.isFunction(options[key])){options[key]();}});}}).mouseleave(function(e){hideTimer=setTimeout(function(){$controls.hide();$('.'+hiliteClass).removeClass(hiliteClass);},30);});}});}};$.fn.ipModuleInlineManagementControls=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementControls');}};})(jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementImage');if(!data){$this.data('ipInlineManagementImage',{key:$this.data('key'),cssClass:$this.data('cssclass'),options:$this.data('options'),defaultValue:$this.data('defaultvalue')}).ipModuleInlineManagementControls({'Manage':function(){$this.trigger('ipModuleInlineManagement.openEditPopup');}}).on('ipModuleInlineManagement.openEditPopup',$.proxy(methods.openPopup,$this));}});},openPopup:function(){var $this=this;$this.css('width','');$this.css('height','');var data=Object();data.aa='InlineManagement.getManagementPopupImage';data.securityToken=ip.securityToken;data.key=$this.data('ipInlineManagementImage').key;data.pageId=ip.pageId;data.languageId=ip.languageId;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._openPopupResponse,dataType:'json'});},_openPopupResponse:function(response){var $this=this;if(response.status=='success'){$('.ipsModuleInlineManagementImageModal').remove();var $popup=$(response.html).appendTo(document.body).modal('show');$popup.css('position','absolute').css($this.offset());var data=$this.data('ipInlineManagementImage');data.popup=$popup;$this.data('ipInlineManagementImage',data);var imageData=response.imageData;var options={};options.image=imageData.imageOrig;options.cropX1=imageData.x1;options.cropY1=imageData.y1;options.cropX2=imageData.x2;options.cropY2=imageData.y2;if(imageData.requiredWidth){options.windowWidth=imageData.requiredWidth;}
if(imageData.requiredHeight){options.windowHeight=imageData.requiredHeight;}
if(imageData.x2&&!options.windowWidth){options.windowWidth=imageData.x2-imageData.x1;}
if(imageData.y2&&!options.windowHeight){options.windowHeight=imageData.y2-imageData.y1;}
if(!options.windowWidth){options.windowWidth=$this.width();}
if(options.windowWidth<10){options.windowWidth=300;}
if(!options.windowHeight){options.windowHeight=$this.height();}
if(options.windowHeight<10){options.windowHeight=100;}
options.enableChangeWidth=true;options.enableChangeHeight=true;options.enableUnderscale=true;options.minWindowWidth=10;options.minWindowHeight=10;options.maxWindowWidth=2000;options.maxWindowHeight=1000;var inlineOptions=$this.data('options');if(inlineOptions.width){options.windowWidth=inlineOptions.width;options.enableChangeWidth=false;}
if(inlineOptions.height){options.windowHeight=inlineOptions.height;options.enableChangeHeight=false;}
$.each($this.data('options'),function(name,value){options[name]=value;});var $imageUploader=$popup.find('.ipsImage');$imageUploader.ipUploadImage(options);$imageUploader.bind('change.ipUploadImage',$.proxy(methods._preview,$this));$this.bind('error.ipUploadImage',{widgetController:this},methods._addError);}
$.proxy(methods._preview,$this)();$popup.find('.ipsConfirm').bind('click',$.proxy(methods._confirm,$this));$popup.find('.ipsCancel').bind('click',$.proxy(methods._cancel,$this));$popup.find('.ipsRemove').bind('click',$.proxy(methods._removeImage,$this));},_removeImage:function(event){event.preventDefault();var $this=this;var $popup=$('.ipsModuleInlineManagementImageModal');if(!confirm($popup.find('.ipsRemoveConfirm').text())){return;}
var data=Object();data.aa='InlineManagement.removeImage';data.key=$this.data('ipInlineManagementImage').key;data.defaultValue=$this.data('ipInlineManagementImage').defaultValue;data.options=$this.data('ipInlineManagementImage').options;data.cssClass=$this.data('ipInlineManagementImage').cssClass;data.securityToken=ip.securityToken;data.pageId=ip.pageId;data.languageId=ip.languageId;data.key=$this.data('ipInlineManagementImage').key;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._removeResponse,dataType:'json'});},_removeResponse:function(answer){var $this=this;if(answer&&answer.status=='success'){var data=$this.data('ipInlineManagementImage');data.popup.modal('hide').remove();$this.css('width','');$this.css('height','');if(answer.newHtml){var $newHtml=$(answer.newHtml);$this.replaceWith($newHtml);$newHtml.ipModuleInlineManagementImage();}}},_preview:function(event){var $this=this;var $popup=$('.ipsModuleInlineManagementImageModal');var $imageUploader=$popup.find('.ipsImage');var windowHeight=$imageUploader.ipUploadImage('height');var windowWidth=$imageUploader.ipUploadImage('width');$this.width(windowWidth).height(windowHeight);$popup.width(windowWidth).height(windowHeight);},_confirm:function(event){event.preventDefault();var $this=$(this);var $popup=$('.ipsModuleInlineManagementImageModal');$this.trigger('ipInlineManagement.logoConfirm');var data=Object();data.aa='InlineManagement.saveImage';data.securityToken=ip.securityToken;data.key=$this.data('ipInlineManagementImage').key;data.defaultValue=$this.data('ipInlineManagementImage').defaultValue;data.options=$this.data('ipInlineManagementImage').options;data.cssClass=$this.data('ipInlineManagementImage').cssClass;data.type=$popup.find('.ipsType').val();data.pageId=ip.pageId;data.languageId=ip.languageId;var ipUploadImage=$('.ipsModuleInlineManagementImageModal').find('.ipsImage');if(ipUploadImage.ipUploadImage('getCurImage')==undefined){$.proxy(methods._cancel,$this)(event);return;}
if(ipUploadImage.ipUploadImage('getNewImageUploaded')){var newImage=ipUploadImage.ipUploadImage('getCurImage');if(newImage){data.newImage=newImage;}}
if(ipUploadImage.ipUploadImage('getCropCoordinatesChanged')&&ipUploadImage.ipUploadImage('getCurImage')!=false){var cropCoordinates=ipUploadImage.ipUploadImage('getCropCoordinates');if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2;data.windowWidth=ipUploadImage.ipUploadImage('getImageWidth');data.windowHeight=ipUploadImage.ipUploadImage('getImageHeight');}}
$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._confirmResponse,dataType:'json'});},_confirmResponse:function(answer){var $this=this;if(answer&&answer.status=='success'){var data=$this.data('ipInlineManagementImage');data.popup.modal('hide').remove();$this.css('width','');$this.css('height','');if(answer.newHtml){var $newHtml=$(answer.newHtml);$this.replaceWith($newHtml);$newHtml.ipModuleInlineManagementImage();}}},_cancel:function(event){event.preventDefault();var $this=this;var data=$this.data('ipInlineManagementImage');data.popup.modal('hide').remove();$this.css('width','');$this.css('height','');}};$.fn.ipModuleInlineManagementImage=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementImage');}};})(jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementLogo');if(!data){$this.data('ipInlineManagementLogo',{'originalLogo':$this.clone(),'imageUploadInitialized':false,'cssClass':$this.data('cssClass')});$this.bind('ipModuleInlineManagementLogo.openEditPopup',$.proxy(openEditPopup,$this));$this.ipModuleInlineManagementControls({'Manage':function(){$this.trigger('ipModuleInlineManagementLogo.openEditPopup');}});}});}};var updateType=function(e){var $this=this;var $popup=$('.ipsModuleInlineManagementLogoModal');if($popup.find('.active a[data-logotype]').data('logotype')=='text'){}else{if(!$this.data('ipInlineManagementLogo').imageUploadInitialized){var $imageUploader=$popup.find('.ipsImage');$imageUploader.ipUploadImage($this.data('ipUploadImageOptions'));var data=$this.data('ipInlineManagementLogo');data.imageUploadInitialized=true;$this.data('ipInlineManagementLogo',data);$imageUploader.bind('change.ipUploadImage',$.proxy(preview,$this));}}
$.proxy(preview,$this)();};var openEditPopup=function(event){event.preventDefault();var $this=$(this);$('.ipsModuleInlineManagementLogoModal').remove();var $this=this;var data=Object();data.aa='InlineManagement.getManagementPopupLogo';data.securityToken=ip.securityToken;data.cssClass=$this.data('cssclass');$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:popupContentResponse,dataType:'json'});};var confirm=function(event){event.preventDefault();var $this=$(this);var $popup=$('.ipsModuleInlineManagementLogoModal');$this.trigger('ipInlineManagement.logoConfirm');var data=Object();data.aa='InlineManagement.saveLogo';data.securityToken=ip.securityToken;data.cssClass=$this.data('ipInlineManagementLogo').cssClass;if($popup.find('.active a[data-logotype]').data('logotype')=='text'){data.type='text';}else{data.type='image';}
data.text=$this.data('logoText').val();data.color=$this.data('logoColor').val();data.font=$this.data('fontSelect').ipInlineManagementFontSelector('getFont');if($this.data('ipInlineManagementLogo').imageUploadInitialized){var ipUploadImage=$popup.find('.ipsImage');if(ipUploadImage.ipUploadImage('getNewImageUploaded')){var newImage=ipUploadImage.ipUploadImage('getCurImage');if(newImage){data.newImage=newImage;}}
if(ipUploadImage.ipUploadImage('getCropCoordinatesChanged')&&ipUploadImage.ipUploadImage('getCurImage')!=false){var cropCoordinates=ipUploadImage.ipUploadImage('getCropCoordinates');if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2;data.windowWidth=ipUploadImage.ipUploadImage('width');data.windowHeight=ipUploadImage.ipUploadImage('height');}}}
$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:confirmResponse,dataType:'json'});};var confirmResponse=function(answer){var $this=this;var $modal=$('.ipsModuleInlineManagementLogoModal');if(answer&&answer.status=='success'){$modal.modal('hide');if(answer.logoHtml){var $newLogo=$(answer.logoHtml);$this.replaceWith($newLogo);$newLogo.ipModuleInlineManagementLogo();}
$this.trigger('ipInlineManagement.logoConfirm');}};var cancel=function(){var $this=this;$this.removeClass('hidden');$this.data('previewText').remove();$this.data('previewImage').remove();var data=$this.data('ipInlineManagementLogo');data.imageUploadInitialized=false;$this.data('ipInlineManagementLogo',data);$this.trigger('ipInlineManagement.logoCancel');};var popupContentResponse=function(response){var $this=this;var $responseHtml=$(response.html);$(document.body).append($responseHtml);var $modal=$responseHtml.find('.ipsModuleInlineManagementLogoModal');$modal.modal();$this.data('fontSelect',$modal.find('.ipsFontSelect'));$this.data('colorPicker',$modal.find('.ipsColorPicker'));$this.data('logoText',$modal.find('.ipsLogoText'));$this.data('logoColor',$modal.find('.ipsLogoColor'));$this.data('previewText',$(response.textPreview));$this.data('previewImage',$(response.imagePreview));$this.after($this.data('previewText'));$this.after($this.data('previewImage'));$this.data('previewImage').addClass('hidden');$this.data('previewText').addClass('hidden');var $anchor=$this.data('previewText').find('a');var curColor=$anchor.css('color');var curText=$.trim($anchor.text());var curFont=$anchor.css('font-family');$anchor.css('font-family','');var defaultFont=$anchor.css('font-family');$anchor.css('font-family',curFont);$modal.find('ipsDefaultFont').css('font-family',defaultFont);if(curFont.indexOf(',')==false){curFont=curFont+',sans-serif';}
$this.data('logoText').css('font-family',curFont);$this.data('curFont',curFont);var options={};var logoData=response.logoData;$this.data('curData',logoData);options.image=logoData.imageOrig;options.cropX1=logoData.x1;options.cropY1=logoData.y1;options.cropX2=logoData.x2;options.cropY2=logoData.y2;options.windowWidth=logoData.requiredWidth;options.windowHeight=logoData.requiredHeight;if(logoData.x2&&!options.windowWidth){options.windowWidth=logoData.x2-logoData.x1;}
if(logoData.y2&&!options.windowHeight){options.windowHeight=logoData.y2-logoData.y1;}
if(!options.windowWidth){options.windowWidth=400;}
if(!options.windowHeight){options.windowHeight=100;}
options.enableChangeHeight=true;options.enableChangeWidth=true;options.enableUnderscale=true;options.minWindowWidth=10;options.minWindowHeight=10;options.maxWindowWidth=774;options.maxWindowHeight=310;$this.data('ipUploadImageOptions',options);$this.data('logoText').val(curText);$this.data('logoText').on('change keyup',$.proxy(preview,$this));$this.data('fontSelect').ipInlineManagementFontSelector({'hide_fallbacks':true,'initial':curFont,'selected':function(style){$this.data('fontSelect').find('.ipsFontName').css('font-family',style);$this.data('curFont',style);$.proxy(preview,$this)();}});$this.data('colorPicker').find('i').css('background-color',curColor);$this.data('logoColor').val(rgb2hex(curColor));$this.data('colorPicker').parent().colorpicker({format:'hex',color:rgb2hex(curColor),container:$this.data('colorPicker'),input:$this.data('logoColor')}).on('changeColor.colorpicker',function(ev){$this.data('colorPicker').find('i').css('background-color',ev.color.toHex());$.proxy(preview,$this)();});$modal.find('a[data-logotype]').on('shown.bs.tab',$.proxy(updateType,$this));if(logoData.type=='text'){$modal.find('a[data-logotype="text"]').tab('show');}else{$modal.find('a[data-logotype="image"]').tab('show');}
$modal.find('.ipsImage').one('ready.ipUploadImage',$.proxy(preview,$this));$modal.find('.ipsConfirm').bind('click',$.proxy(confirm,$this));$modal.on('hide.bs.modal',function(){$.proxy(cancel,$this)();});};var preview=function(){var $this=this;var $modal=$('.ipsModuleInlineManagementLogoModal');$this.addClass('hidden');if($modal.find('.active a[data-logotype]').data('logotype')=='text'){$this.data('previewImage').addClass('hidden');$this.data('previewText').removeClass('hidden');$this.data('previewText').find('a').text($this.data('logoText').val()).css('color',$this.data('logoColor').val()).css('font-family',$this.data('curFont'));}else{$this.data('previewText').addClass('hidden');$this.data('previewImage').removeClass('hidden');var $imageUploader=$modal.find('.ipsImage');$this.data('previewImage').html('<div class="ip"></div>');$this.data('previewImage').find('div').append($imageUploader.find('.ipsModuleUploadWindow').clone());$this.data('previewImage').find('.ipsButtons').remove();$this.data('previewImage').find('.ui-resizable-handle').remove();}};var rgb2hex=function(rgb){rgb=rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return(rgb&&rgb.length===4)?"#"+
("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[2],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[3],10).toString(16)).slice(-2):rgb;};$.fn.ipModuleInlineManagementLogo=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementLogo');}};})(jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementText');if(!data){$this.data('ipInlineManagementText',{key:$this.data('key'),cssClass:$this.data('cssclass'),htmlTag:$this.data('htmltag'),defaultValue:$this.data('defaultvalue')});var cssClass=$this.data('ipInlineManagementText').cssClass;var key=$this.data('ipInlineManagementText').key;var htmlTag=$this.data('ipInlineManagementText').htmlTag;var customTinyMceConfig=$this.data('tinyMceConfig');if(!customTinyMceConfig){if(typeof(ipInlineManagementTinyMceConfig)!=='undefined'){var options={id:$this.data('key'),class:$this.data('cssclass'),tag:$this.data('htmltag'),default:$this.data('defaultvalue')}
customTinyMceConfig=ipInlineManagementTinyMceConfig(options);}
if(!customTinyMceConfig){customTinyMceConfig=ipTinyMceConfig();}}
customTinyMceConfig.setup=function(ed,l){ed.on('change',function(e){save($this.html(),key,cssClass,htmlTag);})};$this.tinymce(customTinyMceConfig);}});}};var save=function(html,key,cssClass,htmlTag){var $this=$(this);var data=Object();data.aa='InlineManagement.saveText';data.securityToken=ip.securityToken;data.cssClass=cssClass;data.key=key;data.htmlTag=htmlTag;data.value=html;data.languageId=ip.languageId;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:saveResponse,dataType:'json'});};var saveResponse=function(answer){var $this=this;if(answer&&answer.status=='success'){if(answer.stringHtml){var $newElement=$(answer.stringHtml);$this.replaceWith($newElement);$newElement.ipModuleInlineManagementText();}
$this.trigger('ipInlineManagement.stringConfirm');$('.ipModuleInlineManagementPopupText').dialog('close');}};$.fn.ipModuleInlineManagementText=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementText');}};})(jQuery);jQuery.fn.ipInlineManagementFontSelector=function(options){if(options=='getFont'){var root=$(this);if(!root.attr('style')){return null}
return root.css('font-family');}
var settings=$.extend({'hide_fallbacks':false,'selected':function(style){},'initial':''},options);return this.each(function(){var root=$(this);var ul=$(this).find('ul');ul.hide();var visible=false;if(settings['initial']!=''){var curFontExists=false;var initialBaseFont=$.trim(settings['initial'].substr(0,settings['initial'].indexOf(',')).replace(/\'/g,''));root.find('li a').each(function(){var font=$(this).text();var baseFont=$.trim(font.substr(0,font.indexOf(',')).replace(/\'/g,''));if(baseFont.toLowerCase()==initialBaseFont.toLowerCase()){curFontExists=true;}});if(!curFontExists){var defaultFontLabel=root.find('.ipsDefaultFont').html();root.find('.ipsFontName').html(defaultFontLabel.substr(0,defaultFontLabel.indexOf(',')));root.css('font-family',root.find('.ipsDefaultFont').css('font-family'));}else{root.find('.ipsFontName').html(initialBaseFont);root.css('font-family',settings['initial']);}}
ul.find('li a').each(function(){$(this).css("font-family",$(this).text());if(settings['hide_fallbacks']){var content=$(this).text();$(this).text(content.substr(0,content.indexOf(',')));}});ul.find('li a').click(function(){if(!visible)
return;ul.slideUp('fast',function(){visible=false;});root.find('.ipsFontName').html($(this).text());root.css('font-family',$(this).css('font-family'));if($(this).hasClass('ipsDefaultFont')){settings['selected']('');root.css('font-family','');}else{settings['selected']($(this).css('font-family'));}});$(this).click(function(event){if(visible)
return;event.stopPropagation();ul.slideDown('fast',function(){visible=true;});});$('html').click(function(){if(visible){ul.slideUp('fast',function(){visible=false;});}})});};